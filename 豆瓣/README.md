# 豆瓣电影评论爬虫与分析系统

这是一个基于 Flask 框架开发的 Web 应用程序，旨在爬取豆瓣电影的短评数据，并进行可视化分析。用户可以通过输入豆瓣电影详情页的 URL，自动抓取评论，生成词云图，查看评分统计，并支持导出数据为 CSV 文件。

## 功能特性

*   **用户登录**: 提供基础的登录验证机制，保护系统访问。
*   **数据爬取**: 
    *   支持输入任意豆瓣电影详情页 URL。
    *   采用多线程并发爬取技术，提高数据抓取效率。
    *   自动解析电影标题、评分、简介及评论信息。
*   **数据分析**:
    *   **评分统计**: 自动统计“力荐”、“推荐”、“还行”、“较差”、“很差”等各个评分等级的数量。
    *   **词频统计**: 使用 `jieba` 分词库分析评论内容，提取出现频率最高的前 10 个关键词。
*   **可视化展示**:
    *   **词云图**: 根据评论内容生成精美的词云图片，直观展示观众对电影的核心评价和情感倾向。
    *   **仪表盘**: 综合展示电影基本信息、评分分布图表和词云图。
*   **数据管理**:
    *   **评论流**: 以列表形式展示抓取到的所有详细评论数据（用户、内容、评分、时间）。
    *   **数据导出**: 支持将当前爬取的电影评论数据一键导出为 CSV 文件（Excel 可直接打开）。

## 项目结构

```text
豆瓣/
├── douban.py           # 主程序入口，包含 Flask 路由配置和控制器逻辑
├── storage.py          # 数据存储模块，负责数据的内存管理和 CSV 文件生成
├── analysis.py         # 数据分析模块，负责评分统计、词频分析和词云生成
├── templates/          # 前端 HTML 模板文件夹
│   ├── login.html          # 登录页面
│   ├── dashboard.html      # 主仪表盘页面（核心功能区）
│   ├── comments_stream.html # 评论列表展示页面
│   ├── about.html          # 关于页面
│   └── crawler.html        # (旧版) 爬虫页面
└── README.md           # 项目说明文档
```

## 快速开始

### 1. 环境准备

确保您的电脑上已安装 Python 3.x。

### 2. 安装依赖库

本项目依赖以下第三方库，请在终端或命令行中运行以下命令进行安装：

```bash
pip install flask requests beautifulsoup4 jieba wordcloud
```

### 3. 运行项目

在项目根目录下运行 `douban.py` 文件：

```bash
python douban.py
```

### 4. 访问应用

程序启动后，打开浏览器访问以下地址（默认端口为 5001）：

```
http://127.0.0.1:5001
```

## 使用说明

1.  **登录**: 进入首页后，点击登录（演示模式下可直接点击登录或输入任意账号）。
2.  **爬取数据**: 
    *   在仪表盘页面的输入框中粘贴豆瓣电影详情页的 URL（例如：`https://movie.douban.com/subject/1292052/`）。
    *   点击“开始爬取”按钮。
3.  **查看分析**: 爬取完成后，页面会自动刷新，展示电影信息、评分统计图表和词云图。
4.  **查看详情**: 点击导航栏的“评论流”可以查看具体的评论列表。
5.  **导出数据**: 在仪表盘页面点击“下载CSV”按钮即可保存数据。

## 注意事项

*   **字体依赖**: 词云生成功能依赖于系统字体文件。程序默认会在 `C:/Windows/Fonts/` 目录下查找 `msyh.ttc` (微软雅黑) 或 `simhei.ttf` (黑体)。如果您的系统不是 Windows 或缺少这些字体，请在 `analysis.py` 中修改 `font_path` 路径。
*   **网络访问**: 由于豆瓣网站有反爬虫机制，频繁爬取可能会导致 IP 被暂时封禁。程序中已包含 User-Agent 随机切换机制以降低风险。
